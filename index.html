<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studi Kasus Nahwu - Bagian 3</title>
    <style>
        /* Tampilan Artikel Pelajaran (Samaran) */
        body { font-family: 'Times New Roman', serif; line-height: 1.8; color: #444; padding: 40px; max-width: 700px; margin: auto; background: #fff; text-align: justify; }
        
        #pass-container {
            margin-top: 20px;
            padding: 15px;
            border-top: 1px solid #eee;
            text-align: center;
        }
        
        #hidden-trigger {
            width: 80%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            background: #fafafa;
            outline: none;
            display: none;
            margin: 10px auto;
        }

        .hidden-chat { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f0f2f5; z-index: 10000; flex-direction: column; }
        
        /* Gaya Chat Bubble Minimalis */
        #msg-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; background-color: #f0f2f5; }
        
        .bubble { 
            margin-bottom: 8px; 
            padding: 12px 16px; 
            border-radius: 18px; 
            max-width: 80%; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-size: 14px;
            line-height: 1.4;
            position: relative;
            box-shadow: 0 1px 1px rgba(0,0,0,0.05);
            word-wrap: break-word;
        }
        
        .me { align-self: flex-end; background: #007aff; color: #fff; border-bottom-right-radius: 4px; }
        .them { align-self: flex-start; background: #fff; color: #000; border-bottom-left-radius: 4px; border: 1px solid #e0e0e0; }
        
        .img-msg { max-width: 100%; border-radius: 12px; display: block; margin-top: 5px; }
        .sender-info { font-size: 11px; font-weight: 600; margin-bottom: 3px; display: block; opacity: 0.8; }

        /* Bottom Bar */
        #bottom-bar { padding: 12px; background: #fff; display: flex; gap: 10px; align-items: center; border-top: 1px solid #ddd; }
        #text-input { flex: 1; padding: 10px 15px; border-radius: 20px; border: 1px solid #ddd; outline: none; background: #f8f8f8; color: #333; font-size: 16px; }
        .btn { background: #007aff; border: none; color: white; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .btn-img { background: #636e72; font-size: 18px; }
    </style>
</head>
<body>

    <div id="decoy-content">
        <h2>Analisis I'rab pada Isim Tasniyah</h2>
        <p>Ilmu nahwu merupakan disiplin fundamental dalam studi bahasa Arab yang membahas struktur sintaksis (tarkƒ´b al-jumlah) serta perubahan akhir kata (i‚ÄòrƒÅb) berdasarkan fungsi gramatikalnya dalam kalimat.
            Dalam konteks akademik, nahwu tidak hanya dipahami sebagai seperangkat kaidah, tetapi sebagai sistem analisis linguistik yang membentuk kerangka berpikir sistematis dalam memahami teks Arab klasik maupun
            kontemporer. Secara historis, fondasi ilmu nahwu dirumuskan secara sistematis oleh para ulama bahasa generasi awal, di antaranya Imam Sibawaih melalui karya monumentalnya, Al-Kitab.</p>
        
        <div id="pass-container">
            <p><i id="click-trigger" style="cursor:pointer; color: #777; text-decoration: underline;">Ketik untuk lanjut baca...</i></p>
            <input type="password" id="hidden-trigger" placeholder="Masukkan kode Mata Kuliah">
        </div>
    </div>

    <div id="secret-chat" class="hidden-chat">
        <div id="msg-container"></div>
        <div id="bottom-bar">
            <input type="file" id="fileInp" hidden onchange="uploadPhoto()">
            <button class="btn btn-img" onclick="document.getElementById('fileInp').click()">üì∑</button>
            <input type="text" id="text-input" placeholder="Tulis pesan...">
            <button class="btn" onclick="sendMsg()">‚û§</button>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbw7dZ9w-ORcjbo2cjmhLmcX965w18YQrd2mXnj0zjHmpd4Uqswdf8azNoCAUm-Bfd2OHQ/exec"; 
        const SECRET = "21191108";
        let myName = "";

        const trigger = document.getElementById('click-trigger');
        const hiddenInput = document.getElementById('hidden-trigger');
        const msgContainer = document.getElementById('msg-container');

        trigger.addEventListener('click', () => {
            trigger.style.display = 'none';
            hiddenInput.style.display = 'block';
            hiddenInput.focus();
        });

        hiddenInput.addEventListener('input', (e) => {
            if (e.target.value === SECRET) {
                startChat();
                e.target.value = "";
                hiddenInput.blur();
            }
        });

        async function startChat() {
            if (!myName) myName = prompt("Masukkan Nama:"); 
            if (myName) {
                document.getElementById('secret-chat').style.display = 'flex';
                document.getElementById('decoy-content').style.display = 'none';
                fetchData();
                setInterval(fetchData, 4000);
            }
        }

        // Fungsi Helper untuk membuat bubble chat secara instan
        function createBubble(name, text, isMe) {
            const div = document.createElement('div');
            div.className = `bubble ${isMe ? 'me' : 'them'}`;
            const isImg = text.startsWith("data:image");
            const content = isImg ? `<img src="${text}" class="img-msg">` : text;
            div.innerHTML = `<span class="sender-info">${name}</span>${content}`;
            msgContainer.appendChild(div);
            msgContainer.scrollTop = msgContainer.scrollHeight;
        }

        async function fetchData() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                msgContainer.innerHTML = "";
                data.forEach(item => {
                    if(!item[0] || !item[1]) return;
                    createBubble(item[0], item[1], item[0] === myName);
                });
            } catch (e) { console.log("Reconnecting..."); }
        }

        async function post(val) {
            // Instant UI Update: Pesan muncul dulu di layar
            createBubble(myName, val, true);
            
            // Pengiriman ke server dilakukan di latar belakang
            try {
                await fetch(API_URL, { 
                    method: "POST", 
                    mode: 'no-cors', // Mempercepat respon karena tidak menunggu header CORS
                    body: JSON.stringify({ nama: myName, pesan: val }) 
                });
            } catch (e) { console.log("Gagal sinkron"); }
        }

        function sendMsg() {
            const input = document.getElementById('text-input');
            const pesan = input.value;
            if (pesan) { 
                input.value = ""; // Kosongkan input seketika
                post(pesan); 
            }
        }

        function uploadPhoto() {
            const file = document.getElementById('fileInp').files[0];
            const reader = new FileReader();
            reader.onloadend = () => post(reader.result);
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
