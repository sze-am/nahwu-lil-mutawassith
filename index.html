<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Materi Nahwu - Bagian 3</title>
    <style>
        body { font-family: serif; background: #fff; padding: 30px; line-height: 1.6; color: #333; }
        #decoy { max-width: 600px; margin: auto; }
        /* Room Chat Tersembunyi */
        #secret-room { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0b141a; z-index: 1000; flex-direction: column; }
        #messages { flex: 1; overflow-y: auto; padding: 15px; background: #0b141a; display: flex; flex-direction: column; }
        .bubble { margin: 5px; padding: 10px; border-radius: 10px; max-width: 80%; font-family: sans-serif; color: #000; }
        .me { align-self: flex-end; background: #d9fdd3; }
        .them { align-self: flex-start; background: #fff; }
        .img-chat { max-width: 100%; border-radius: 5px; margin-top: 5px; }
        #input-area { padding: 10px; background: #202c33; display: flex; gap: 10px; }
        #chat-input { flex: 1; padding: 10px; border-radius: 20px; border: none; background: #2a3942; color: white; outline: none; }
        button { background: #00a884; border: none; color: white; padding: 10px 15px; border-radius: 50%; cursor: pointer; }
    </style>
</head>
<body>

    <div id="decoy">
        <h2>Bab 3: Pembagian I'rab</h2>
        <p>I'rab adalah perubahan akhir kata karena perbedaan amil yang masuk, baik secara lafadz maupun perkiraan. I'rab ada empat: Rafa', Nashab, Khafadh, dan Jazm...</p>
        <p><em>(Klik layar lalu ketik kode rahasia untuk diskusi)</em></p>
    </div>

    <div id="secret-room">
        <div id="messages"></div>
        <div id="input-area">
            <input type="file" id="imgFile" hidden onchange="upImg()">
            <button onclick="document.getElementById('imgFile').click()">ðŸ“·</button>
            <input type="text" id="chat-input" placeholder="Tulis pesan...">
            <button onclick="send()">âž¤</button>
        </div>
    </div>

    <script>
        const GAS_URL = "URL_WEB_APP_GOOGLE_SCRIPT_KAMU";
        let buffer = "";
        const PASS = "21191108";
        let user = "";

        // Masuk tanpa kotak input (Stealth)
        document.addEventListener('keydown', (e) => {
            if(!isNaN(e.key)) buffer += e.key;
            if(buffer.includes(PASS)) {
                user = prompt("Inisial:");
                if(user) {
                    document.getElementById('secret-room').style.display = 'flex';
                    sync(); setInterval(sync, 4000);
                }
                buffer = "";
            }
        });

        async function sync() {
            const r = await fetch(GAS_URL);
            const data = await r.json();
            const box = document.getElementById('messages');
            box.innerHTML = "";
            data.forEach(row => {
                const d = document.createElement('div');
                d.className = `bubble ${row[0] === user ? 'me' : 'them'}`;
                d.innerHTML = row[1].startsWith("data:image") ? `<b>${row[0]}</b><br><img src="${row[1]}" class="img-chat">` : `<b>${row[0]}</b><br>${row[1]}`;
                box.appendChild(d);
            });
            box.scrollTop = box.scrollHeight;
        }

        async function post(msg) {
            await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ nama: user, pesan: msg }) });
            sync();
        }

        function send() {
            const i = document.getElementById('chat-input');
            if(i.value) { post(i.value); i.value = ""; }
        }

        function upImg() {
            const f = document.getElementById('imgFile').files[0];
            const reader = new FileReader();
            reader.onloadend = () => post(reader.result);
            reader.readAsDataURL(f);
        }
    </script>
</body>
</html>
