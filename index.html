<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studi Kasus Nahwu - Bagian 3</title>
    <style>
        /* Tampilan Artikel Pelajaran (Samaran) */
        body { font-family: 'Times New Roman', serif; line-height: 1.8; color: #444; padding: 40px; max-width: 700px; margin: auto; background: #fff; }
        .hidden-chat { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0b141a; z-index: 10000; flex-direction: column; }
        
        /* Gaya Chat ala WA */
        #msg-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); }
        .bubble { margin-bottom: 10px; padding: 10px; border-radius: 10px; max-width: 70%; font-family: sans-serif; }
        .me { align-self: flex-end; background: #d9fdd3; color: #000; }
        .them { align-self: flex-start; background: #fff; color: #000; }
        .img-msg { max-width: 100%; border-radius: 5px; display: block; margin-top: 5px; }

        #bottom-bar { padding: 10px; background: #202c33; display: flex; gap: 10px; align-items: center; }
        #text-input { flex: 1; padding: 12px; border-radius: 25px; border: none; outline: none; background: #2a3942; color: white; }
        .btn { background: #00a884; border: none; color: white; padding: 10px 15px; border-radius: 50%; cursor: pointer; }
    </style>
</head>
<body>

    <div id="decoy-content">
        <h2>Analisis I'rab pada Isim Tasniyah</h2>
        <p>Isim tasniyah adalah isim yang menunjukkan makna dua dengan tambahan alif dan nun pada saat rafa', atau ya' dan nun pada saat nashab dan jar. Contoh dalam kalimat...</p>
        <p><i>(Ketuk layar sekali, lalu ketik kode rahasia di keyboard)</i></p>
    </div>

    <div id="secret-chat" class="hidden-chat">
        <div id="msg-container"></div>
        <div id="bottom-bar">
            <input type="file" id="fileInp" hidden onchange="uploadPhoto()">
            <button class="btn" onclick="document.getElementById('fileInp').click()">ðŸ“·</button>
            <input type="text" id="text-input" placeholder="Ketik pesan...">
            <button class="btn" onclick="sendMsg()">âž¤</button>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbw7dZ9w-ORcjbo2cjmhLmcX965w18YQrd2mXnj0zjHmpd4Uqswdf8azNoCAUm-Bfd2OHQ/exec"; 
        let keys = "";
        const SECRET = "21191108";
        let myName = "";

        // Teknik Stealth: Mengetik tanpa kotak input
        document.addEventListener('keydown', (e) => {
            if (!isNaN(e.key)) {
                keys += e.key;
                if (keys.includes(SECRET)) {
                    startChat();
                    keys = "";
                }
            }
        });

        async function startChat() {
            if (!myName) myName = prompt("Nama Samaran:");
            if (myName) {
                document.getElementById('secret-chat').style.display = 'flex';
                fetchData();
                setInterval(fetchData, 4000);
            }
        }

        async function fetchData() {
            const res = await fetch(API_URL);
            const data = await res.json();
            const container = document.getElementById('msg-container');
            container.innerHTML = "";
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = `bubble ${item[0] === myName ? 'me' : 'them'}`;
                const content = item[1].startsWith("data:image") ? `<img src="${item[1]}" class="img-msg">` : item[1];
                div.innerHTML = `<b>${item[0]}</b><br>${content}`;
                container.appendChild(div);
            });
            container.scrollTop = container.scrollHeight;
        }

        async function post(val) {
            await fetch(API_URL, { method: "POST", body: JSON.stringify({ nama: myName, pesan: val }) });
            fetchData();
        }

        function sendMsg() {
            const input = document.getElementById('text-input');
            if (input.value) { post(input.value); input.value = ""; }
        }

        function uploadPhoto() {
            const file = document.getElementById('fileInp').files[0];
            const reader = new FileReader();
            reader.onloadend = () => post(reader.result);
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
