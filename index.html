<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studi Kasus Nahwu - Bagian 3</title>
    <style>
        /* Tampilan Artikel Pelajaran (Samaran Akademik) */
        body { font-family: 'Times New Roman', serif; line-height: 1.8; color: #444; padding: 40px; max-width: 800px; margin: auto; background: #fff; text-align: justify; }
        h2 { text-align: center; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        #pass-container {
            margin-top: 30px;
            padding: 20px;
            background: #f9f9f9;
            border: 1px dashed #ccc;
            border-radius: 8px;
            text-align: center;
        }
        
        #hidden-trigger {
            width: 80%;
            padding: 12px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 16px;
            outline: none;
            display: none;
            margin: 10px auto;
        }

        .hidden-chat { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f0f2f5; z-index: 10000; flex-direction: column; }
        
        /* Gaya Chat Bubble Minimalis Responsif */
        #msg-container { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; background-color: #f0f2f5; scroll-behavior: smooth; }
        
        .bubble { 
            margin-bottom: 10px; 
            padding: 12px 16px; 
            border-radius: 18px; 
            max-width: 85%; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-size: 14px;
            line-height: 1.4;
            box-shadow: 0 1px 1px rgba(0,0,0,0.08);
            word-wrap: break-word;
        }
        
        .me { align-self: flex-end; background: #007aff; color: #fff; border-bottom-right-radius: 4px; }
        .them { align-self: flex-start; background: #fff; color: #000; border-bottom-left-radius: 4px; border: 1px solid #e0e0e0; }
        
        .img-msg { max-width: 100%; border-radius: 10px; display: block; margin-top: 5px; }
        .sender-info { font-size: 11px; font-weight: 600; margin-bottom: 3px; display: block; opacity: 0.8; }

        /* Bottom Bar */
        #bottom-bar { padding: 10px 15px; background: #fff; display: flex; gap: 10px; align-items: center; border-top: 1px solid #ddd; padding-bottom: env(safe-area-inset-bottom); }
        #text-input { flex: 1; padding: 12px 15px; border-radius: 20px; border: 1px solid #ddd; outline: none; background: #f8f8f8; font-size: 16px; }
        .btn { background: #007aff; border: none; color: white; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .btn-img { background: #636e72; }
    </style>
</head>
<body>

    <div id="decoy-content">
        <h2>Analisis I'rab pada Isim Tasniyah</h2>
        <p>Ilmu nahwu merupakan disiplin fundamental dalam studi bahasa Arab yang membahas struktur sintaksis (tarkƒ´b al-jumlah) serta perubahan akhir kata (i‚ÄòrƒÅb) berdasarkan fungsi gramatikalnya dalam kalimat.
            Dalam konteks akademik, nahwu tidak hanya dipahami sebagai seperangkat kaidah, tetapi sebagai sistem analisis linguistik yang membentuk kerangka berpikir sistematis dalam memahami teks Arab klasik maupun
            kontemporer. Secara historis, fondasi ilmu nahwu dirumuskan secara sistematis oleh para ulama bahasa generasi awal, di antaranya Imam Sibawaih melalui karya monumentalnya, Al-Kitab.</p>
        
        <p>Pendekatan dan Metodologi Pembelajaran: Pembelajaran dirancang berbasis analisis teks (text-based learning) dan problem solving. Mahasiswa tidak hanya menghafal kaidah, tetapi dilatih
            untuk melakukan i‚ÄòrƒÅb secara sistematis dan argumentatif, mengidentifikasi ‚ÄòƒÅmil yang memengaruhi perubahan akhir kata, serta menganalisis teks turats tanpa harakat.</p>
            
        <div id="pass-container">
            <p><i id="click-trigger" style="cursor:pointer; color: #2980b9; text-decoration: underline;">Klik di sini untuk verifikasi kehadiran dan akses materi tambahan...</i></p>
            <input type="password" id="hidden-trigger" placeholder="Masukkan Kode Mata Kuliah">
        </div>
    </div>

    <div id="secret-chat" class="hidden-chat">
        <div id="msg-container"></div>
        <div id="bottom-bar">
            <input type="file" id="fileInp" hidden onchange="uploadPhoto()">
            <button class="btn btn-img" onclick="document.getElementById('fileInp').click()">üì∑</button>
            <input type="text" id="text-input" placeholder="Tulis pesan...">
            <button class="btn" onclick="sendMsg()">‚û§</button>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbw7dZ9w-ORcjbo2cjmhLmcX965w18YQrd2mXnj0zjHmpd4Uqswdf8azNoCAUm-Bfd2OHQ/exec"; 
        const SECRET = "21191108";
        const myName = "Kelas PBA 6A"; // Nama otomatis sesuai permintaan

        const trigger = document.getElementById('click-trigger');
        const hiddenInput = document.getElementById('hidden-trigger');
        const container = document.getElementById('msg-container');

        trigger.addEventListener('click', () => {
            trigger.style.display = 'none';
            hiddenInput.style.display = 'block';
            hiddenInput.focus();
        });

        hiddenInput.addEventListener('input', (e) => {
            if (e.target.value === SECRET) {
                startChat();
                e.target.value = "";
                hiddenInput.blur();
            }
        });

        async function startChat() {
            document.getElementById('secret-chat').style.display = 'flex';
            document.getElementById('decoy-content').style.display = 'none';
            fetchData();
            setInterval(fetchData, 4000);
        }

        // Fungsi menampilkan pesan ke layar
        function appendMessage(name, text, isMe) {
            const div = document.createElement('div');
            div.className = `bubble ${isMe ? 'me' : 'them'}`;
            const isImg = text.startsWith("data:image");
            const content = isImg ? `<img src="${text}" class="img-msg">` : text;
            div.innerHTML = `<span class="sender-info">${name}</span>${content}`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        async function fetchData() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                container.innerHTML = "";
                data.forEach(item => {
                    if(!item[0] || !item[1]) return;
                    appendMessage(item[0], item[1], item[0] === myName);
                });
            } catch (e) { console.log("Reconnecting..."); }
        }

        async function sendMsg() {
            const input = document.getElementById('text-input');
            const val = input.value;
            if (!val) return;
            
            // Responsif: Langsung tampilkan di layar tanpa tunggu server
            appendMessage(myName, val, true); 
            input.value = "";
            
            await fetch(API_URL, { method: "POST", body: JSON.stringify({ nama: myName, pesan: val }) });
        }

        function uploadPhoto() {
            const file = document.getElementById('fileInp').files[0];
            const reader = new FileReader();
            reader.onloadend = async () => {
                const base64 = reader.result;
                appendMessage(myName, base64, true); // Langsung tampilkan foto
                await fetch(API_URL, { method: "POST", body: JSON.stringify({ nama: myName, pesan: base64 }) });
            };
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
