<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studi Kasus Nahwu - Bagian 3</title>
    <style>
        /* Tampilan Artikel Pelajaran (Samaran) */
        body { font-family: 'Times New Roman', serif; line-height: 1.8; color: #444; padding: 40px; max-width: 700px; margin: auto; background: #fff; }
        
        /* Input Rahasia untuk memicu keyboard di HP */
        #hidden-trigger {
            position: absolute;
            opacity: 0;
            width: 1px;
            height: 1px;
        }

        .hidden-chat { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f0f2f5; z-index: 10000; flex-direction: column; }
        
        /* Gaya Chat Bubble Minimalis (Bukan WA) */
        #msg-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; background-color: #f0f2f5; }
        
        .bubble { 
            margin-bottom: 8px; 
            padding: 12px 16px; 
            border-radius: 18px; 
            max-width: 80%; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-size: 14px;
            line-height: 1.4;
            position: relative;
            box-shadow: 0 1px 1px rgba(0,0,0,0.05);
        }
        
        /* Bubble Saya: Biru Modern / Gelap */
        .me { 
            align-self: flex-end; 
            background: #007aff; 
            color: #fff; 
            border-bottom-right-radius: 4px;
        }
        
        /* Bubble Lawan: Putih Bersih */
        .them { 
            align-self: flex-start; 
            background: #fff; 
            color: #000; 
            border-bottom-left-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        
        .img-msg { max-width: 100%; border-radius: 12px; display: block; margin-top: 5px; }
        .sender-info { font-size: 11px; font-weight: 600; margin-bottom: 3px; display: block; opacity: 0.8; }

        /* Bottom Bar Minimalis */
        #bottom-bar { padding: 12px; background: #fff; display: flex; gap: 10px; align-items: center; border-top: 1px solid #ddd; }
        #text-input { flex: 1; padding: 10px 15px; border-radius: 20px; border: 1px solid #ddd; outline: none; background: #f8f8f8; color: #333; }
        .btn { background: #007aff; border: none; color: white; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .btn-img { background: #636e72; font-size: 18px; }
    </style>
</head>
<body>

    <div id="decoy-content">
        <h2>Analisis I'rab pada Isim Tasniyah</h2>
        <p>Isim tasniyah adalah isim yang menunjukkan makna dua dengan tambahan alif dan nun pada saat rafa', atau ya' dan nun pada saat nashab dan jar. Contoh dalam kalimat...</p>
        
        <p><i id="click-trigger" style="cursor:pointer; color: #777;">Ketik untuk lanjut baca...</i></p>
        <input type="number" id="hidden-trigger" pattern="\d*">
    </div>

    <div id="secret-chat" class="hidden-chat">
        <div id="msg-container"></div>
        <div id="bottom-bar">
            <input type="file" id="fileInp" hidden onchange="uploadPhoto()">
            <button class="btn btn-img" onclick="document.getElementById('fileInp').click()">ðŸ“·</button>
            <input type="text" id="text-input" placeholder="Tulis pesan...">
            <button class="btn" onclick="sendMsg()">âž¤</button>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbw7dZ9w-ORcjbo2cjmhLmcX965w18YQrd2mXnj0zjHmpd4Uqswdf8azNoCAUm-Bfd2OHQ/exec"; 
        let keys = "";
        const SECRET = "21191108";
        let myName = "";

        const trigger = document.getElementById('click-trigger');
        const hiddenInput = document.getElementById('hidden-trigger');

        // Munculkan keyboard saat teks diklik
        trigger.addEventListener('click', () => {
            hiddenInput.focus();
        });

        // Tangkap input dari keyboard HP maupun Desktop
        hiddenInput.addEventListener('input', (e) => {
            keys += e.target.value;
            e.target.value = ""; // Bersihkan input agar bisa terus mengetik
            if (keys.includes(SECRET)) {
                startChat();
                keys = "";
                hiddenInput.blur(); // Tutup keyboard
            }
        });

        // Tetap dukung keyboard desktop
        document.addEventListener('keydown', (e) => {
            if (!isNaN(e.key)) {
                keys += e.key;
                if (keys.includes(SECRET)) {
                    startChat();
                    keys = "";
                }
            }
        });

        async function startChat() {
            if (!myName) myName = prompt("Nama Samaran:");
            if (myName) {
                document.getElementById('secret-chat').style.display = 'flex';
                document.getElementById('decoy-content').style.display = 'none';
                fetchData();
                setInterval(fetchData, 4000);
            }
        }

        async function fetchData() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                const container = document.getElementById('msg-container');
                container.innerHTML = "";
                data.forEach(item => {
                    if(!item[0] || !item[1]) return;
                    const div = document.createElement('div');
                    div.className = `bubble ${item[0] === myName ? 'me' : 'them'}`;
                    const content = item[1].startsWith("data:image") ? `<img src="${item[1]}" class="img-msg">` : item[1];
                    div.innerHTML = `<span class="sender-info">${item[0]}</span>${content}`;
                    container.appendChild(div);
                });
                container.scrollTop = container.scrollHeight;
            } catch (e) { console.log("Reconnecting..."); }
        }

        async function post(val) {
            await fetch(API_URL, { method: "POST", body: JSON.stringify({ nama: myName, pesan: val }) });
            fetchData();
        }

        function sendMsg() {
            const input = document.getElementById('text-input');
            if (input.value) { post(input.value); input.value = ""; }
        }

        function uploadPhoto() {
            const file = document.getElementById('fileInp').files[0];
            const reader = new FileReader();
            reader.onloadend = () => post(reader.result);
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
